MONGODB Queries

--- connect to localhost

mongodb://localhost:27017
show dbs
use latestdb
show collections
db.createCollection('teacher')

--- create

use latest_db
db.students.insertOne({name:"Leela",age:78})
db.students.insertMany([{name:"Leela",age:78},{name:"Leela",age:78}]) --> in list form


--- find


db.students.find() 
first 20 entries will be shown embedded in list
returns cursor(ptr) , which can be iterate
if no matching entries matches return nothing(empty)

db.students.findOne({age:78})
if no matching entries matches return null


--- methods only relying on cursor 


db.students.find()  -> first 20 displayed
db.students.find().toArray()  -> All displayed

db.students.find().count()
db.students.find().limit(2)
db.students.find().forEach((x)=>{printjson(x)})  

db.students.findOne({age:{$lt:20}}) 
--> lessthan <

db.students.findOne({age:{$lte:20}}) 
--> lessthan equalsto <=

db.students.findOne({age:{$gt:20}}) 
--> greaterthan >

db.students.findOne({age:{$gte:20}}) 
--> greaterthan equalsto >=

db.students.find({age:{$gte:20,$lte:40}}) 
--> 20<=age<=40

db.students.findOne({age:{$lte:20}}).count()
db.students.findOne({age:{$lte:20}}).limit(2)


--- nested Documents /update 

limit of document is 16MB
document can be nested 100 times

db.students.updateOne({name:"Sejal"},{$set:{ idCards:{hasPanCard:true , hasAdharCard:true}}})  
--> specified name data updated

db.students.updateOne({},{$set:{ idCards:{hasPanCard:true , hasAdharCard:true}}})  
--> only first data updated , no change if already updated

db.students.updateMany({},{$set:{ idCards:{hasPanCard:true , hasAdharCard:true}}})  
--> All entries data updated

db.students.updateMany({},{$set:{ hobbies:\['Anime','Cooking']}})
--> multiple hobbies set in an array


--- Advance update

$inc: increments the value of a field by a specified amount.
 db.students.updateMany({},{$inc: {age:2}})  
 -> existing age increase by 2

$min: updates the value of a field if the specified value is less than the current value of the field.
db.students.updateOne({name:'Sita'},{$min: {age:20}})

$max: updates the value of a field if the specified value is greater than the current value of the field.
 db.students.updateOne({name:'Sita'},{$max: {age:20}})

$mul: The $mul operator multiplies the value of a field by a specified amount.
 db.students.updateOne({name:'Sita'},{$mul: {age:2}})

$unset: The $unset operator removes a specific field from a document.
 db.students.updateOne({},{$unset: {age:465555}})

$rename: The $rename operator renames a field.
 db.students.updateMany({},{$rename: {age:'studAge'}})

Upsert: combination of an update + an insert operation. 
If a document matching the update criteria does not exist, the update operation creates a new document with the specified update criteria. If a document matching the update criteria does exist, the update operation modifies the existing document.
 db.students.updateMany({},{$rename: {age:'studAge'}},{upsert:true})

--- Delete Queries/DB


db.students.deleteMany({isEligible: false})

db.students.deleteMany({})

db.dropDatabase()  -> All Collections Deleted

db.students.drop() -> students collection deleted


--- Selecting specific column


db.students.find({},{name:1, _id:0})


--- Datatypes

Text

Boolean

Number -> Integer -32bit

       -> NumberLong -64bit

       -> NUmberDecimal

ObjectId

ISODate

TimeStamp

Array

Emd Docs( nested )


Example:

[

 {

    _id: ObjectId('6935bc4205e0922c761e2621'),

    name: 'Gaurav',

    isStudent: false,

    isEmployee: true,

    CompanyData: [ { name: 'Valeo', Package: '5lpa' }, { name: 'Ptc', Package: 8 } ],

    PlacedOn: ISODate('2025-12-07T17:41:21.997Z'),

    PlacedOnTimestamp: Timestamp({ t: 1765129282, i: 1 })

  }

]


--- Ordered option


db.students.insertMany(\[{name:"Leela",age:78},{name:"Rama",age:78}],{ordered:false})

--> bydefault ordered is true that's why when error occurs it terminates

    by making it false, we skip the errored part and execute all possible entries


--- Concerns

db.teacher.insertOne({name:'Shailesh',subject:'DAA',info:[{ExperiencedYears:10,email:'Shaileshji@gmail.in'}]},{writeConcern:{w:0,j:true}})


--- Atomicity

atomicity achieved at document level
can't rollback if any causes mid termination
either document will be inserted/update/delete or not


--- Mongoimport

Mongoimport is a command-line tool that is used to import data from a JSON, CSV, or TSV file into a MongoDB database. 
It allows you to easily load large amounts of data into your database from a file.

To use mongoimport, you will need to have MongoDB installed on your system and have a database and collection set up in which to import the data. 
Once you have these things ready, you can use the mongoimport command to import data from a file into your database.

mongoimport --db database_name --collection collection_name --file file.json

OR

mongoimport "C:\Users\sejuh\OneDrive\Desktop\Mongo\students.json" -d college -c students --jsonArray --drop

if not exist create college db 
student collection , if present then drops it


--- Comparison Operator

returns true/false

$eq:equality 
$ne:inequality
$gt:greater than
$gte:greater than or equal to
$lt:less than
$lte:less than or equal to
$in: db.students.find({age:{$in:[5,11,12]}})
$nin: db.students.find({age:{$nin:[5,11,12]}})


-- logical operator

$and: returns true if all the expressions are true.
db.students.find({$and:[{age:{$lte:10}},{Hobbies:'Walk'}]})

$or: returns true if at least one of the expressions is true.
db.students.find({$or:[{age:{$lte:10}},{age:{$gte:12}}]})

$not: returns true if the expression is false and false if the expression is true.


--- operator exists & type

db.students.find({ hasMacBook: { $exists: true } } )

db.collection.find({ field: { $exists: true, $in: [value1, value2, value3] } })

This would retrieve all documents from the collection where the field exists and has a value of value1, value2, or value3.

db.collection.find({ field: { $type: typeCode } })

This would retrieve all documents from the collection where the field has the data type specified by typeCode

1 - double
2 - string
3 - object
4 - array
5 - binary data
6 - undefined (deprecated)
7 - object id
8 - boolean
9 - date
10 - null
11 - regular expression
13 - javascript
14 - symbol
15 - javascript (with scope)
16 - 32-bit integer
17 - timestamp
18 - 64-bit integer


--- Evaluation op

$expr : allows you to use JavaScript expressions
db.students.find({$exp: {$gt: ['price',{$avg : 'price'}]}})
db.students.find({$and: [{experience: {$exists: true}},{$expr: {$gte:[{$size: '$experience'},3]}}]})

$regex : allows you to use regular expressions

$mod : allows you to use modulo arithmetic in queries.
db.students.find({price:{$mod:{3,0}}}) 
price is divisible by 3 , remainder 0

db.students.find({age:{$mod:[2,0]}})
even age

$text : allows you to perform full-text searches on the database.
db.students.createIndex({bio:"text"})
bio_text
db.students.find({$text:{$search:"youtube"}})

$jsonSchema : allows you to validate the structure and content of documents in a collection based on a provided JSON schema.


--- Arrays

Q.find students having 3 companies experience

db.students.find({$and: [{experience: {$exists: true}},{$expr: {$gte:[{$size: '$experience'},3]}}]})


Q.find students having hobbies Walking and Reading

db.students.find({Hobbies:['Walking','Reading']})
-> only gives exact match 

db.students.find({Hobbies:{$all:['Walking','Reading']}})
-> gives reversible match too

db.students.find({Hobbies:{$in:['Walking','Reading']}})



db.students.find({$and:[{'Product.name':'apple'},{'Product.quantity':15}}]})

db.students.find({Products:{$elemMatch:{quantity:{$gt:11},name:"apple"}}})


---- Sort

ascending , those having same age will first give alpha.. first name
db.students.find().sort({age:1,name:1})

descending
db.students.find().sort({age:-1})

db.students.find().sort({age:1,name:1}).skip(20)

db.students.find().sort({age:1,name:1}).forEach(x => printjson(x))






